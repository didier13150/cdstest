{"version":"v1.0","name":"pipeline","jobs":[{"job":"integration","steps":[{"script":["echo \"Sonar URL: {{.cds.proj.sonarURL}}\""]},{"checkout":"{{.cds.workspace}}"},{"name":"Run composer update","script":["php -d memory_limit=-1 /usr/bin/composer update"]},{"name":"Run composer to add ci tools","script":["php -d memory_limit=-1 /usr/bin/composer require --dev phpunit/phpunit pdepend/pdepend"]},{"name":"Create reports dir","script":["mkdir reports"]},{"name":"Run phpunit","script":["php -d memory_limit=-1 {{.cds.workspace}}/vendor/bin/phpunit --log-junit reports/web-phpunit.xml --coverage-clover reports/web-clover.xml --coverage-html reports/web-coverage"]},{"name":"Run pdepend","script":["php -d memory_limit=-1 {{.cds.workspace}}/vendor/bin/pdepend --jdepend-xml=reports/jdepend.xml src"]},{"jUnitReport":"{{.cds.workspace}}/reports/web-phpunit.xml"},{"coverage":{"format":"clover","path":"{{.cds.workspace}}/reports/web-clover.xml"}},{"serveStaticFiles":{"name":"Coverage","path":"{{.cds.workspace}}/reports/web-coverage"}},{"name":"Install sonnar-scanner","script":["echo https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-${SONNAR_SCANNER_VERSION}.zip \u0026\u0026 curl -fsSL https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-${SONNAR_SCANNER_VERSION}.zip -o /tmp/sonar-scanner-cli-${SONNAR_SCANNER_VERSION}.zip \u0026\u0026 pushd /opt \u0026\u0026 unzip /tmp/sonar-scanner-cli-${SONNAR_SCANNER_VERSION}.zip \u0026\u0026 mv sonar-scanner-${SONNAR_SCANNER_VERSION} sonar-scanner \u0026\u0026 popd \u0026\u0026 rm -rf /tmp/sonar-scanner-cli-${SONNAR_SCANNER_VERSION}.zip"]},{"name":"SonarScanner","script":["/opt/sonar-scanner/bin/sonar-scanner -Dsonar.sources=src -Dsonar.host.url=https://sonar.tartarefr.eu"]},{"SonarScanner":{"sonar-project.properties":"sonar.projectKey={{.cds.application}}\nsonar.projectName={{.cds.application}}\nsonar.projectVersion={{.git.hash}}\nsonar.sources=src\nsonar.exclusions=**/*_test.go,**/vendor/**\nsonar.tests=tests\nsonar.test.inclusions=**/*_test.go\nsonar.test.exclusions=**/vendor/**\nsonar.sourceEncoding=UTF-8\nsonar.php.coverage.reportPath=reports/phpunit.coverage.xml\nsonar.php.tests.reportPath=reports/phpunit.report.xml","sonarDownloadURL":"https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-{{.sonarVersion}}-linux.zip","sonarPassword":"{{.cds.proj.sonarPassword}}","sonarURL":"{{.cds.proj.sonarURL}}","sonarUsername":"{{.cds.proj.sonarUsername}}","sonarVersion":"4.3.0.2102","workspace":"{{.cds.workspace}}"}}],"requirements":[{"binary":"bash","service":{}},{"binary":"composer","service":{}},{"binary":"curl","service":{}},{"binary":"git","service":{}},{"binary":"java","service":{}},{"binary":"unzip","service":{}}]}]}